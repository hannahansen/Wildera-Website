<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@200;300;400;500;600;700;800&display=swap" rel="stylesheet">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Wildera | Rings</title>
  <link href="rings.css" rel="stylesheet" type="text/css">
</head>
<body>

<header>
  <div class="top-header">
    <h1 class="header-title" aria-label="Wildera">
      <span class="logo-wild">WILD</span><span class="logo-era">ERA</span>
    </h1>

    <input type="checkbox" id="menu-toggle"/>
    <label for="menu-toggle" class="menu-button"><span>Menu</span></label>

    <nav class="menu">
      <ul>
        <li><a href="index.html#home">Home</a></li>
        <li><a href="shop.html">Shop</a></li>
        <li><a href="index.html#about">About</a></li>
        <li><a href="faq.html">FAQ</a></li>
        <li><a href="index.html#contact">Contact</a></li>
        <li><a href="cart.html">Cart</a></li>
      </ul>
    </nav>
  </div>
</header>

<main class="product-list">

  <!-- COLLECTION GRID (auto-built from products below) -->
  <section class="collection" aria-label="Rings collection">
    <h2 class="collection-title">Rings</h2>
    <p class="collection-subtitle">browse the collection, then tap for details.</p>
    <div class="collection-grid" id="collection-grid"></div>
  </section>

  <hr class="collection-divider" aria-hidden="true" />

  <!-- PRODUCT 1 -->

  <!-- PRODUCT 2 -->

</main>

<section class="connect">
  <div class="connect-content">
    <h2>Connect On Social Media!</h2>
    <a href="https://www.tiktok.com/@wildera.jewelry/">
      <img src="tiktok.png" alt="Tiktok">
    </a>
    <a href="https://www.instagram.com/wildera.jewelry">
      <img src="instagram.png" alt="Instagram">
    </a>
  </div>
</section>

<footer class="footer">
  <div class="footer-content">
    <p>Â© 2025 Wildera. All rights reserved.</p>
  </div>
</footer>

<script>
  // Build the top collection grid from the product cards on the page
  (function () {
    const grid = document.getElementById('collection-grid');
    if (!grid) return;

    const cards = Array.from(document.querySelectorAll('.product-card[data-product-id]'));

    cards.forEach((card) => {
      const id = card.getAttribute('data-product-id');
      if (!id) return;

      // Ensure the card has an anchor target
      if (!card.id) card.id = id;

      const name =
        (card.getAttribute('data-product-name') ||
          card.querySelector('.product-title')?.textContent ||
          'product').trim();

      const price = Number(card.getAttribute('data-product-price') || 0);

      const imgSrc =
        card.getAttribute('data-product-image') ||
        card.querySelector('.carousel-slide')?.getAttribute('src') ||
        '';

      const a = document.createElement('a');
      a.className = 'collection-item';
      a.href = `#${card.id}`;

      a.innerHTML = `
        <img src="${imgSrc}" alt="${name}">
        <div class="collection-text">
          <div class="collection-name">${name.toLowerCase()}</div>
          <div class="collection-price">$${price.toFixed(2)}</div>
        </div>
      `;

      grid.appendChild(a);
    });
  })();
</script>

<script>
  (function () {
    // --- Carousel ---
    document.querySelectorAll('.carousel').forEach((carousel) => {
      const slides = Array.from(carousel.querySelectorAll('.carousel-slide'));
      const prev = carousel.querySelector('.carousel-btn.prev');
      const next = carousel.querySelector('.carousel-btn.next');
      if (!slides.length || !prev || !next) return;

      let index = 0;
      function render() {
        slides.forEach((img, i) => (img.style.display = i === index ? 'block' : 'none'));
      }

      prev.addEventListener('click', () => {
        index = (index - 1 + slides.length) % slides.length;
        render();
      });

      next.addEventListener('click', () => {
        index = (index + 1) % slides.length;
        render();
      });

      render();
    });

    // --- Cart (localStorage) ---
    const CART_KEY = 'wildera_cart_v1';

    function loadCart() {
      try {
        return JSON.parse(localStorage.getItem(CART_KEY) || '[]');
      } catch {
        return [];
      }
    }

    function saveCart(cart) {
      localStorage.setItem(CART_KEY, JSON.stringify(cart));
    }

    function getInCartQty(cart, id) {
      const found = cart.find((i) => i.id === id);
      return found ? Number(found.qty || 0) : 0;
    }

    function setStatus(card, text) {
      const el = card.querySelector('.cart-status');
      if (el) el.textContent = text;
    }

    function refreshButtons() {
      const cart = loadCart();

      document.querySelectorAll('.product-card[data-product-id]').forEach((card) => {
        const id = card.getAttribute('data-product-id');
        const stock = Number(card.getAttribute('data-product-stock') || 0);
        const inCart = getInCartQty(cart, id);
        const btn = card.querySelector('.add-to-cart');
        if (!btn) return;

        const priceEl = card.querySelector('.product-price');
        const stockEl = card.querySelector('.product-stock');
        const price = Number(card.getAttribute('data-product-price') || 0);
        if (priceEl) priceEl.textContent = `$${price.toFixed(2)}`;
        if (stockEl) {
          const remainingNow = Math.max(0, stock - inCart);
          stockEl.textContent = `In stock: ${remainingNow}`;
        }

        if (stock <= 0) {
          btn.disabled = true;
          btn.textContent = 'Sold out';
          setStatus(card, '');
          return;
        }

        const remaining = Math.max(0, stock - inCart);

        if (remaining <= 0) {
          btn.disabled = true;
          btn.textContent = 'In cart (max)';
          setStatus(card, 'Max quantity reached for this item.');
        } else {
          btn.disabled = false;
          btn.textContent = 'Add to cart';
          setStatus(card, '');
        }
      });
    }

    document.querySelectorAll('.product-card[data-product-id]').forEach((card) => {
      const btn = card.querySelector('.add-to-cart');
      if (!btn) return;

      btn.addEventListener('click', () => {
        const id = card.getAttribute('data-product-id');
        const name = card.getAttribute('data-product-name') || 'Item';
        const price = Number(card.getAttribute('data-product-price') || 0);
        const stock = Number(card.getAttribute('data-product-stock') || 0);
        const image = card.getAttribute('data-product-image') || '';
        const stripePriceId = card.getAttribute('data-stripe-price-id');

        const cart = loadCart();
        const currentQty = getInCartQty(cart, id);

        if (currentQty >= stock) {
          refreshButtons();
          return;
        }

        const existing = cart.find((i) => i.id === id);
        if (existing) {
        existing.qty = Number(existing.qty || 1) + 1;

        if (!existing.stripePriceId) existing.stripePriceId = stripePriceId;
        } else {
        cart.push({ id, name, price, qty: 1, stock, image, stripePriceId });
        }

        saveCart(cart);
        refreshButtons();
      });
    });

    window.addEventListener('storage', refreshButtons);
    refreshButtons();
  })();
</script>

</body>
</html>